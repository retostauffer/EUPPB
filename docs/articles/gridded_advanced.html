<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gridded data: Advanced • eupp</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Gridded data: Advanced">
<meta property="og:description" content="eupp">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">eupp</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0-2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Gridded data
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/gridded.html">Getting started</a>
    </li>
    <li>
      <a href="../articles/gridded_analysis.html">Gridded analysis</a>
    </li>
    <li>
      <a href="../articles/gridded_forecasts.html">Gridded forecasts</a>
    </li>
    <li>
      <a href="../articles/gridded_advanced.html">Gridded advanced</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Station data
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/station.html">Getting started</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li>
  <a href="../contact.html">Contact</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/retostauffer/eupp/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Gridded data: Advanced</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/retostauffer/eupp/blob/HEAD/vignettes/gridded_advanced.Rmd" class="external-link"><code>vignettes/gridded_advanced.Rmd</code></a></small>
      <div class="hidden name"><code>gridded_advanced.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="underlying-concept-in-more-details">Underlying concept in more details<a class="anchor" aria-label="anchor" href="#underlying-concept-in-more-details"></a>
</h2>
<p>The article “<a href="gridded.html#underlying-concept"><em>Getting started with gridded data</em></a>” shows the basic use of the <em>eupp</em> gridded data interface. For those interested, this article shows some more insights how the package works under the hood.</p>
<p>Some functions might be useful for (i) debugging or (ii) adding additional functionality around the <em>eupp</em> package. In some more detail, the gridded dataset functionality works as follows:</p>
<ol style="list-style-type: decimal">
<li>The user specifies the data set to be downloaded/retrieved using the <code><a href="../reference/eupp_config.html">eupp_config()</a></code> function which returns an object of class <code>eupp_config</code>.</li>
<li>The user calls <code><a href="../reference/gridded.html">eupp_download_gridded()</a></code> or <code><a href="../reference/gridded.html">eupp_get_gridded()</a></code> to retrieve the data in different formats (the first allows for GRIB version 1 and different NetCDF file formats; the latter for <code>stars</code> objects). Below the surface <em>eupp</em> performs the following steps:
<ol style="list-style-type: lower-alpha">
<li>Defining the GRIB index files required to identify the necessary GRIB messages</li>
<li>Downloading and parsing the GRIB index files to identify files and byte ranges</li>
<li>Partially downloading the GRIB files (required messages via <code>curl</code>) and stores the requested messages in a new GRIB version 1 file.</li>
<li>If a NetCDF file has been requested: making required manipulations on the GRIB file and converting it to NetCDF, wherefore <a href="https://confluence.ecmwf.int/display/ECC/ecCodes+Home" class="external-link">ecCodes</a> needs to be installed.</li>
<li>If a <a href="https://cran.r-project.org/package=stars" class="external-link"><code>stars</code></a> object has been requested: read the NetCDF file. This goes trough the intermediate step of creating a NetCDF file; thus <a href="https://confluence.ecmwf.int/display/ECC/ecCodes+Home" class="external-link">ecCodes</a> is necessary.</li>
</ol>
</li>
</ol>
<p>When calling <code><a href="../reference/gridded.html">eupp_download_gridded()</a></code> a file will be created on success (GRIB version 1 or NetCDF), while <code><a href="../reference/gridded.html">eupp_get_gridded()</a></code> returns a <code>stars</code> object in the active <em>R</em> session. Temporary files are deleted as soon as no longer needed (stored in <code><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir()</a></code>).</p>
</div>
<div class="section level2">
<h2 id="specify-dataset-to-be-downloaded">Specify dataset to be downloaded<a class="anchor" aria-label="anchor" href="#specify-dataset-to-be-downloaded"></a>
</h2>
<p>To demonstrate the intermediate steps listed above, a data set specification (configuration) is required. For this purpose a small subset of gridded surface ensemble forecast data is used.</p>
<ul>
<li>
<code>cache = "_cache"</code>: Enables GRIB index caching which can be useful if the same GRIB indes file has to be accessed multiple times (as in this article).</li>
<li>Imagine not knowing which parameters, forecast steps, or perturbation numbers (members) are available.</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://retostauffer.github.io/eupp/" class="external-link">"eupp"</a></span><span class="op">)</span>
<span class="op">(</span><span class="va">conf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eupp_config.html">eupp_config</a></span><span class="op">(</span>product   <span class="op">=</span> <span class="st">"forecast"</span>,                    <span class="co"># forecasts</span>
                     type      <span class="op">=</span> <span class="st">"ens"</span>,                         <span class="co"># ensemble forecasts</span>
                     level     <span class="op">=</span> <span class="st">"surface"</span>,                     <span class="co"># surface fields</span>
                     date      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2017-05-05"</span>, <span class="st">"2017-06-05"</span><span class="op">)</span>, <span class="co"># 'random' dates; ISO YYYY-mm-dd</span>
                     cache     <span class="op">=</span> <span class="st">"_cache"</span><span class="op">)</span><span class="op">)</span>                     <span class="co"># enable caching</span></code></pre></div>
<pre><code><span class="co">## EUPP Config</span>
<span class="co">##    Product:             forecast (fcs)</span>
<span class="co">##    Level:               surface</span>
<span class="co">##    Type:                ens</span>
<span class="co">##    Date(s):             2017-05-05,2017-06-05</span>
<span class="co">##    Parameter:           all available</span>
<span class="co">##    Steps:               all available</span>
<span class="co">##    Members:             all available</span>
<span class="co">##    Version:             0</span>
<span class="co">##    Cache:               _cache</span>
<span class="co">##    Area:                not defined</span></code></pre>
<p>Until now an <em>R</em> object of class <code>eupp_config</code> has been created which is used further down in the pipeline to process the request.</p>
</div>
<div class="section level2">
<h2 id="define-required-files">Define required files<a class="anchor" aria-label="anchor" href="#define-required-files"></a>
</h2>
<p>The next step is to define the URL(s) of the file(s) to be accessed to process the request. This is done by the function <code><a href="../reference/eupp_get_source_urls.html">eupp_get_source_urls()</a></code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Required GRIB index files:</span>
<span class="fu"><a href="../reference/eupp_get_source_urls.html">eupp_get_source_urls</a></span><span class="op">(</span><span class="va">conf</span>, fileext <span class="op">=</span> <span class="st">"index"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] "https://storage.ecmwf.europeanweather.cloud/eumetnet-postprocessing-benchmark-training-dataset/data/fcs/surf/EU_forecast_ctr_surf_params_2017-05_0.grb.index"   </span>
<span class="co">## [2] "https://storage.ecmwf.europeanweather.cloud/eumetnet-postprocessing-benchmark-training-dataset/data/fcs/surf/EU_forecast_ens_surf_params_2017-05-05_0.grb.index"</span>
<span class="co">## [3] "https://storage.ecmwf.europeanweather.cloud/eumetnet-postprocessing-benchmark-training-dataset/data/fcs/surf/EU_forecast_ctr_surf_params_2017-06_0.grb.index"   </span>
<span class="co">## [4] "https://storage.ecmwf.europeanweather.cloud/eumetnet-postprocessing-benchmark-training-dataset/data/fcs/surf/EU_forecast_ens_surf_params_2017-06-05_0.grb.index"</span></code></pre>
<p>As shown above, four different files have to be accessed as we (i) are asking for forecasts issued on two different dates (<code>date</code>) and have not explicitly defined <code>members</code> wherefore we need both, control run forecasts (handled as <code>member = 0</code>) and perturbed forecasts (<code>members</code> 1, 2, …).</p>
<p>When <code>fileext</code> is not defined (<code>fileext = NULL</code>; default) one gets the URLs for the corresponding GRIB files for direct access.</p>
</div>
<div class="section level2">
<h2 id="gridded-advanced-inventory">Getting (full) inventory<a class="anchor" aria-label="anchor" href="#gridded-advanced-inventory"></a>
</h2>
<p>In this scenario we imagined not having more information on what is available. To get more insights we can use the configuration <code>conf</code> from above to get a complete list of all messages in the GRIB index inventories listed above by calling <code><a href="../reference/gridded.html">eupp_get_inventory()</a></code>.</p>
<p><code><a href="../reference/gridded.html">eupp_get_inventory()</a></code> internally calls <code>eupp_get_source_urls(..., fileext = "index")</code>, downloads the index files (line-wise JSON strings), parses them, and puts them into an object of class <code>c("eupp_inventory", "data.frame")</code> (basic <code>data.frame</code>; no dedicated S3 methods so far).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Getting inventory (based on `conf` from above)</span>
<span class="va">inv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gridded.html">eupp_get_inventory</a></span><span class="op">(</span><span class="va">conf</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">inv</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] "eupp_inventory" "data.frame"</span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">inv</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 292740     17</span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">inv</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##                                                          path domain levtype</span>
<span class="co">## 11001 data/fcs/surf/EU_forecast_ctr_surf_params_2017-05_0.grb      g     sfc</span>
<span class="co">## 11002 data/fcs/surf/EU_forecast_ctr_surf_params_2017-05_0.grb      g     sfc</span>
<span class="co">## 11003 data/fcs/surf/EU_forecast_ctr_surf_params_2017-05_0.grb      g     sfc</span>
<span class="co">## 11004 data/fcs/surf/EU_forecast_ctr_surf_params_2017-05_0.grb      g     sfc</span>
<span class="co">## 11005 data/fcs/surf/EU_forecast_ctr_surf_params_2017-05_0.grb      g     sfc</span>
<span class="co">## 11006 data/fcs/surf/EU_forecast_ctr_surf_params_2017-05_0.grb      g     sfc</span>
<span class="co">##       step_char param class type stream expver leg_number    offset length</span>
<span class="co">## 11001         0    2t    od   cf   enfo   0001          1 253676400  23412</span>
<span class="co">## 11002         0   10u    od   cf   enfo   0001          1 253699920  23412</span>
<span class="co">## 11003         0   10v    od   cf   enfo   0001          1 253723440  23412</span>
<span class="co">## 11004         0   tcc    od   cf   enfo   0001          1 253746960  23412</span>
<span class="co">## 11005         0    tp    od   cf   enfo   0001          1 253770480  23412</span>
<span class="co">## 11006         0  100u    od   cf   enfo   0001          1 253794000  23412</span>
<span class="co">##       param_id number       init step      valid</span>
<span class="co">## 11001      167      0 2017-05-05    0 2017-05-05</span>
<span class="co">## 11002      165      0 2017-05-05    0 2017-05-05</span>
<span class="co">## 11003      166      0 2017-05-05    0 2017-05-05</span>
<span class="co">## 11004      164      0 2017-05-05    0 2017-05-05</span>
<span class="co">## 11005      228      0 2017-05-05    0 2017-05-05</span>
<span class="co">## 11006   228246      0 2017-05-05    0 2017-05-05</span></code></pre>
<p>As <code>cache</code> is enabled, the resulting <code>data.frame</code> is stored in _R_s RDS file format into the <code>cache</code> folder; using an md5 checksum of the original URL to keep track of the origin. When downloading another set of data stored in the same GRIB file (thus, same GRIB index file) the cached file will be used which can significantly increase the performance.</p>
<p>The object returned contains information about the <code>path</code> of the grib file (not full URL) alongside with a series of additional information which differ between different products. This inventory tells us that the following parameters (<code>param</code>), steps (<code>step</code>), and ensemble members (<code>number</code>; perturbation number) are available.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">inv</span><span class="op">$</span><span class="va">param</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##  [1] "2t"    "10u"   "10v"   "tcc"   "tp"    "100u"  "100v"  "cape"  "stl1" </span>
<span class="co">## [10] "sshf"  "slhf"  "tcw"   "tcwv"  "swvl1" "ssr"   "str"   "sd"    "cp"   </span>
<span class="co">## [19] "cin"   "ssrd"  "strd"  "vis"   "10fg6" "mn2t6" "mx2t6"</span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">inv</span><span class="op">$</span><span class="va">step</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##   [1]   0   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17</span>
<span class="co">##  [19]  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32  33  34  35</span>
<span class="co">##  [37]  36  37  38  39  40  41  42  43  44  45  46  47  48  49  50  51  52  53</span>
<span class="co">##  [55]  54  55  56  57  58  59  60  61  62  63  64  65  66  67  68  69  70  71</span>
<span class="co">##  [73]  72  73  74  75  76  77  78  79  80  81  82  83  84  85  86  87  88  89</span>
<span class="co">##  [91]  90  93  96  99 102 105 108 111 114 117 120 123 126 129 132 135 138 141</span>
<span class="co">## [109] 144 150 156 162 168 174 180 186 192 198 204 210 216 222 228 234 240</span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">inv</span><span class="op">$</span><span class="va">number</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##  [1]  0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24</span>
<span class="co">## [26] 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49</span>
<span class="co">## [51] 50</span></code></pre>
<p>The full URL to the grib files can be constructed based on <code>inv$path</code> and <code>$BASEURL</code> from <code>eupp:::eupp_get_url_config()</code> (can be redefined using system environment variable <code>EUPP_BASEURL</code>). <code>eupp:::eupp_get_url_config()</code> not only returns the <code>BASEURL</code> but a series of template strings for the different files on the bucket.</p>
</div>
<div class="section level2">
<h2 id="refine-data-set-specification">Refine data set specification<a class="anchor" aria-label="anchor" href="#refine-data-set-specification"></a>
</h2>
<p>A more practical use is to more explicitly define the data set configuration (as we now know what’s needed). Given <code>cache</code> was used above, the GRIB index file should be loaded from disc in a few secs.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://retostauffer.github.io/eupp/" class="external-link">"eupp"</a></span><span class="op">)</span>
<span class="op">(</span><span class="va">conf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eupp_config.html">eupp_config</a></span><span class="op">(</span>product   <span class="op">=</span> <span class="st">"forecast"</span>,
                     type      <span class="op">=</span> <span class="st">"ens"</span>,
                     level     <span class="op">=</span> <span class="st">"surface"</span>,
                     date      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2017-05-05"</span>, <span class="st">"2017-06-05"</span><span class="op">)</span>,
                     parameter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tp"</span>, <span class="st">"sd"</span><span class="op">)</span>,                 <span class="co"># total precip + sunshine duration</span>
                     steps     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">13</span>, <span class="fl">15</span>, by <span class="op">=</span> <span class="fl">2L</span><span class="op">)</span>,          <span class="co"># +13 and +15 hour ahead forecast</span>
                     members   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">14</span><span class="op">)</span>,                     <span class="co"># perturbation 10 and 14 (why not)</span>
                     cache     <span class="op">=</span> <span class="st">"_cache"</span><span class="op">)</span><span class="op">)</span>                     <span class="co"># use caching</span></code></pre></div>
<pre><code><span class="co">## EUPP Config</span>
<span class="co">##    Product:             forecast (fcs)</span>
<span class="co">##    Level:               surface</span>
<span class="co">##    Type:                ens</span>
<span class="co">##    Date(s):             2017-05-05,2017-06-05</span>
<span class="co">##    Parameter:           tp, sd</span>
<span class="co">##    Steps:               13, 15</span>
<span class="co">##    Members:             10, 14</span>
<span class="co">##    Version:             0</span>
<span class="co">##    Cache:               _cache</span>
<span class="co">##    Area:                not defined</span></code></pre>
<p>Getting the required part of the inventory given the configuration above:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">inv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gridded.html">eupp_get_inventory</a></span><span class="op">(</span><span class="va">conf</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##                                                              path domain</span>
<span class="co">## 14503  data/fcs/surf/EU_forecast_ens_surf_params_2017-05-05_0.grb      g</span>
<span class="co">## 14515  data/fcs/surf/EU_forecast_ens_surf_params_2017-05-05_0.grb      g</span>
<span class="co">## 14591  data/fcs/surf/EU_forecast_ens_surf_params_2017-05-05_0.grb      g</span>
<span class="co">## 14603  data/fcs/surf/EU_forecast_ens_surf_params_2017-05-05_0.grb      g</span>
<span class="co">## 16703  data/fcs/surf/EU_forecast_ens_surf_params_2017-05-05_0.grb      g</span>
<span class="co">## 16715  data/fcs/surf/EU_forecast_ens_surf_params_2017-05-05_0.grb      g</span>
<span class="co">## 16791  data/fcs/surf/EU_forecast_ens_surf_params_2017-05-05_0.grb      g</span>
<span class="co">## 16803  data/fcs/surf/EU_forecast_ens_surf_params_2017-05-05_0.grb      g</span>
<span class="co">## 158003 data/fcs/surf/EU_forecast_ens_surf_params_2017-06-05_0.grb      g</span>
<span class="co">## 158015 data/fcs/surf/EU_forecast_ens_surf_params_2017-06-05_0.grb      g</span>
<span class="co">## 158091 data/fcs/surf/EU_forecast_ens_surf_params_2017-06-05_0.grb      g</span>
<span class="co">## 158103 data/fcs/surf/EU_forecast_ens_surf_params_2017-06-05_0.grb      g</span>
<span class="co">## 160203 data/fcs/surf/EU_forecast_ens_surf_params_2017-06-05_0.grb      g</span>
<span class="co">## 160215 data/fcs/surf/EU_forecast_ens_surf_params_2017-06-05_0.grb      g</span>
<span class="co">## 160291 data/fcs/surf/EU_forecast_ens_surf_params_2017-06-05_0.grb      g</span>
<span class="co">## 160303 data/fcs/surf/EU_forecast_ens_surf_params_2017-06-05_0.grb      g</span>
<span class="co">##        levtype step_char param class type stream expver number leg_number</span>
<span class="co">## 14503      sfc        13    tp    od   pf   enfo   0001     10          1</span>
<span class="co">## 14515      sfc        13    sd    od   pf   enfo   0001     10          1</span>
<span class="co">## 14591      sfc        13    tp    od   pf   enfo   0001     14          1</span>
<span class="co">## 14603      sfc        13    sd    od   pf   enfo   0001     14          1</span>
<span class="co">## 16703      sfc        15    tp    od   pf   enfo   0001     10          1</span>
<span class="co">## 16715      sfc        15    sd    od   pf   enfo   0001     10          1</span>
<span class="co">## 16791      sfc        15    tp    od   pf   enfo   0001     14          1</span>
<span class="co">## 16803      sfc        15    sd    od   pf   enfo   0001     14          1</span>
<span class="co">## 158003     sfc        13    tp    od   pf   enfo   0001     10          1</span>
<span class="co">## 158015     sfc        13    sd    od   pf   enfo   0001     10          1</span>
<span class="co">## 158091     sfc        13    tp    od   pf   enfo   0001     14          1</span>
<span class="co">## 158103     sfc        13    sd    od   pf   enfo   0001     14          1</span>
<span class="co">## 160203     sfc        15    tp    od   pf   enfo   0001     10          1</span>
<span class="co">## 160215     sfc        15    sd    od   pf   enfo   0001     10          1</span>
<span class="co">## 160291     sfc        15    tp    od   pf   enfo   0001     14          1</span>
<span class="co">## 160303     sfc        15    sd    od   pf   enfo   0001     14          1</span>
<span class="co">##           offset length param_id       init step               valid</span>
<span class="co">## 14503  334505760  23412      228 2017-05-05   13 2017-05-05 13:00:00</span>
<span class="co">## 14515  334788000  35036      141 2017-05-05   13 2017-05-05 13:00:00</span>
<span class="co">## 14591  336534960  23412      228 2017-05-05   13 2017-05-05 13:00:00</span>
<span class="co">## 14603  336817200  35036      141 2017-05-05   13 2017-05-05 13:00:00</span>
<span class="co">## 16703  385237320  23412      228 2017-05-05   15 2017-05-05 15:00:00</span>
<span class="co">## 16715  385519560  35036      141 2017-05-05   15 2017-05-05 15:00:00</span>
<span class="co">## 16791  387266280  23412      228 2017-05-05   15 2017-05-05 15:00:00</span>
<span class="co">## 16803  387548520  35036      141 2017-05-05   15 2017-05-05 15:00:00</span>
<span class="co">## 158003 335894520  23412      228 2017-06-05   13 2017-06-05 13:00:00</span>
<span class="co">## 158015 336176760  35036      141 2017-06-05   13 2017-06-05 13:00:00</span>
<span class="co">## 158091 337931640  23412      228 2017-06-05   13 2017-06-05 13:00:00</span>
<span class="co">## 158103 338213880  35036      141 2017-06-05   13 2017-06-05 13:00:00</span>
<span class="co">## 160203 386824320  23412      228 2017-06-05   15 2017-06-05 15:00:00</span>
<span class="co">## 160215 387106560  35036      141 2017-06-05   15 2017-06-05 15:00:00</span>
<span class="co">## 160291 388860960  23412      228 2017-06-05   15 2017-06-05 15:00:00</span>
<span class="co">## 160303 389143200  35036      141 2017-06-05   15 2017-06-05 15:00:00</span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">inv</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 16 17</span></code></pre>
<p>The number of observations (rows) in <code>conf</code> matches our exception as asking for (i) two different initialization dates, (ii) two parameters, (iii) two forecast steps (lead times), and (iv) two different members (<span class="math inline">\(2^4 = 16\)</span>).</p>
</div>
<div class="section level2">
<h2 id="downloading-data">Downloading data<a class="anchor" aria-label="anchor" href="#downloading-data"></a>
</h2>
<p>The data sets can be retrieved in three different formats which, however, are connected (top down).</p>
<ol style="list-style-type: decimal">
<li>GRIB version 1 (minimal requirements; <code>curl</code>/<code>rcurl</code>)</li>
<li>NetCDF (requires <a href="https://confluence.ecmwf.int/display/ECC/ecCodes+Home" class="external-link">ecCodes</a> to be installed)</li>
<li>
<code>stars</code> (requires the <em>stars</em> package plus <a href="https://confluence.ecmwf.int/display/ECC/ecCodes+Home" class="external-link">ecCodes</a>)</li>
</ol>
<p>Given the inventory above the <em>eupp</em> package first downloads segments of the original GRIB file via curl byterange. The result is stored in one GRIB file. If this what has been requested by the user, that’s it (1). If the user requests a NetCDF file the GRIB file is stored temporarily and then converted to NetCDF (the console tool <code>grib_set</code> is used to perform some ensemble-required manipulations; then converted to NetCDF via <code>grib_to_netcdf</code>). When asking for <code>stars</code> objects we go trough the two steps above before reading the data sets via <code><a href="https://r-spatial.github.io/stars/reference/read_stars.html" class="external-link">read_stars()</a></code> (<em>stars</em> package). The conversion GRIB &gt; NetCDF &gt; stars is required to do some naming manipulation.</p>
<p><strong>Download data as GRIB Version 1:</strong></p>
<ul>
<li><code>eupp_download_gridded(conf, "my_new_file.grib", "grib")</code></li>
<li>See also: <a href="gridded.html#gridded-download-grib">Getting started: Getting data: GRIB format</a>
</li>
</ul>
<p><strong>Download data and store as NetCDF:</strong></p>
<ul>
<li>
<code>eupp_download_gridded(conf, "my_new_file.grib", "grib")</code>.</li>
<li>
<em>Note</em>: <code>netcdf_kind</code> can be used to control the <code>-k</code> flag when calling <code>grib_to_netcdf</code> (defaults to <code>3</code>); see <code><a href="../reference/gridded.html">eupp_download_gridded()</a></code> and <code>grib_to_netcdf</code> manual.</li>
<li>See also: <a href="gridded.html#gridded-download-netcdf">Getting started: Getting data: NetCDF format</a>
</li>
</ul>
<p><strong>Getting data as [<code>stars</code>][stars] object:</strong></p>
<ul>
<li><code>x &lt;- eupp_get_gridded(conf)</code></li>
<li>See also: <a href="gridded.html#gridded-get-stars">Getting started: <code>stars</code></a>
</li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Reto Stauffer.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
